#!/usr/bin/env bash

if [[ -z "$JOURNAL_DIR" ]]; then
	echo 'Missing $JOURNAL_DIR env variable.' >&2
	exit 1
fi


usage() {
	cat <<-EOF
	usage: ${0##*/} <command> [arguments]

	commands:
	  commit
	  open [document]
	  help
	EOF
}

cmd_commit() {
	cd "$JOURNAL_DIR" && git add . && git commit --message="$(date '+%Y-%m-%d')"
}

cmd_open() {
	local document="$1"
	if [[ -z "$1" ]]; then
		local document='Index'
	fi
	local document="$JOURNAL_DIR/${document}.jtxt"
	if [[ -e "$document" ]]; then
		exec vim "$document"
	else
		echo "File '$document' does not exist." >&2
		exit 1
	fi
}

fail() {
	usage >&2
	exit 1
}

case "$1" in
	commit) cmd_commit ;;
	open)   cmd_open "$2" ;;
	*)      fail ;;
esac
